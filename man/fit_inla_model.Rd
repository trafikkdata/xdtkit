% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/model_inla.R
\name{fit_inla_model}
\alias{fit_inla_model}
\title{Fit INLA model for traffic volume prediction}
\usage{
fit_inla_model(
  data,
  adjacency_matrix = NULL,
  adjacency_matrices = NULL,
  spatial_ids = NULL,
  fixed_effects = ~1,
  iid_effects = "roadSystem",
  spatial_term = ~f(spatial.idx, model = "besagproper", graph = adjacency_matrix,
    adjust.for.con.comp = FALSE, constr = TRUE),
  heavy_vehicle = FALSE,
  family = "poisson"
)
}
\arguments{
\item{data}{Data frame containing traffic data with required columns: id, aadt}

\item{adjacency_matrix}{Adjacency matrix for spatial Besag term (single matrix, for backward compatibility)}

\item{adjacency_matrices}{List of adjacency matrices for multiple spatial terms (optional)}

\item{spatial_ids}{Character vector of spatial ID column names corresponding to adjacency_matrices (optional)}

\item{fixed_effects}{Formula for fixed effects (default: ~ 1 for intercept only)}

\item{iid_effects}{Character vector of variable names for IID random effects (default: "roadSystem")}

\item{spatial_term}{Formula for spatial random effect (default: Besag proper with constraints)
Note: spatial_term is only used when adjacency_matrix is provided (single spatial effect)}

\item{heavy_vehicle}{Logical. Whether or not the model is for heavy vehicles (using the column "heavyAadt" as response) or all vehicles (using column "aadt"). Default FALSE.}

\item{family}{INLA family, either "poisson" or "nbinomial" (default: "poisson")}
}
\value{
Object of class "inla_traffic_model" containing:
  \item{predictions}{Data frame with id, pred (posterior median), sd (posterior SD)}
  \item{model_summary}{Summary of INLA model}
  \item{inla_model}{Full INLA model object}
}
\description{
Fit INLA model for traffic volume prediction
}
\examples{
\dontrun{
# Single spatial effect (backward compatible)
fit_inla_model(data, adjacency_matrix = adj_matrix)

# Multiple spatial effects (e.g., separate for regular and public transport)
fit_inla_model(data,
               adjacency_matrices = list(adj_matrix_regular, adj_matrix_pt),
               spatial_ids = c("spatial_id_regular", "spatial_id_pt"))

# Custom spatial term (single effect)
fit_inla_model(data, adj_matrix,
               spatial_term = ~ f(spatial.idx, model = "bym2", graph = adjacency_matrix))
}
}
