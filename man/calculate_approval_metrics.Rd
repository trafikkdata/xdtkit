% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/validate_after_control.R
\name{calculate_approval_metrics}
\alias{calculate_approval_metrics}
\title{Calculate approval metrics for AADT predictions}
\usage{
calculate_approval_metrics(
  model = NULL,
  pred = NULL,
  sd = NULL,
  data,
  data_manual,
  truth_col = .default_aadt_col,
  aadt_col = .default_aadt_col,
  model_name = "inla",
  is_ratio_model = FALSE,
  ratio_uncertainty_fn = NULL
)
}
\arguments{
\item{model}{An INLA model object with summary.fitted.values. If NULL, must
provide pred and sd, or data must contain prediction columns.}

\item{pred}{Numeric vector of predictions. Used if model is NULL.}

\item{sd}{Numeric vector of standard deviations. Used if model is NULL.}

\item{data}{Data frame containing directed traffic link predictions with
columns parentTrafficLinkId, and optionally pred/sd or balanced_pred/balanced_sd.}

\item{data_manual}{Data frame of manual estimates containing columns ID,
Datagrunnlag.TRP.ID, Strekningslengde..m., and truth_col.}

\item{truth_col}{Character. Name of column in data_manual containing ground
truth AADT values. Default is "<U+00C5>DT.offisiell".}

\item{aadt_col}{Character. Name of column containing total AADT for ratio
models. Default is "<U+00C5>DT.offisiell".}

\item{model_name}{Character. Name to identify the model in output. Default
is "inla".}

\item{is_ratio_model}{Logical. If TRUE, converts ratio predictions to counts
using aadt_col. Default is FALSE.}

\item{ratio_uncertainty_fn}{Optional function(ratio, aadt) to estimate ratio
uncertainty. If NULL, uses default estimation.}
}
\value{
List with four elements:
  \itemize{
    \item summary: Data frame with approval rates, coverage, and eALE metrics
    \item directed_data: Original data with added predictions
    \item undirected_data: Aggregated undirected segments with approval status
    \item segments_without_counters: Filtered data for segments without TRP counters
  }
}
\description{
Main validation function that aggregates directed predictions to undirected
segments and calculates approval rates and error metrics. Compares model
predictions against manual estimates using autoapproval criteria.
}
