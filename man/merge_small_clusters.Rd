% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/model_balancing_clusters.R
\name{merge_small_clusters}
\alias{merge_small_clusters}
\title{Merge Small Clusters with Neighboring Clusters}
\usage{
merge_small_clusters(
  base_assignments,
  network_graph,
  barrier_links,
  min_size = 100,
  max_size = 1000
)
}
\arguments{
\item{base_assignments}{Data frame with columns \code{id} and \code{cluster_id}
containing initial cluster assignments}

\item{network_graph}{An igraph object representing the full link adjacency network
(before barrier removal)}

\item{barrier_links}{Character vector of barrier link IDs used to separate clusters}

\item{min_size}{Minimum target cluster size. Clusters below this are candidates
for merging. Default is 100.}

\item{max_size}{Maximum allowed cluster size after merging. Prevents creating
clusters that are too large. Default is 1000.}
}
\value{
Data frame with same structure as \code{base_assignments} but with
  updated cluster IDs after merging
}
\description{
Iteratively merges clusters smaller than \code{min_size} with neighboring
clusters, preferring neighbors that keep the merged result under \code{max_size}.
Processes smallest clusters first to maximize successful merges.
}
\details{
The merging algorithm:
\enumerate{
  \item Identify clusters smaller than min_size
  \item Sort by size (smallest first)
  \item For each small cluster:
    \itemize{
      \item Find neighboring clusters (looking across barriers)
      \item Filter to neighbors where merged_size <= max_size
      \item Select smallest valid neighbor
      \item Reassign all links to target cluster
      \item Update size tracking for subsequent iterations
    }
  \item Report merge statistics
}
}
\section{Neighbor Finding}{

Neighbors are found by looking through barrier links in the original network.
This allows merging of clusters that are separated by measurement barriers
but would naturally belong together.
}

\section{Merge Strategy}{

\itemize{
  \item Prefers smallest valid neighbors (keeps sizes balanced)
  \item Cannot merge if all neighbors would exceed max_size
  \item Earlier merges affect later ones (updated sizes propagate)
}
}

\examples{
\dontrun{
merged_assignments <- merge_small_clusters(
  base_assignments,
  mainland_graph,
  selected_barriers,
  min_size = 100,
  max_size = 1000
)
}
}
\seealso{
\code{\link{find_neighboring_clusters}}, \code{\link{strategic_network_clustering}}
}
