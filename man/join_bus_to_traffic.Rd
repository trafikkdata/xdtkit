% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_prep_bus_counts.R
\name{join_bus_to_traffic}
\alias{join_bus_to_traffic}
\title{Join bus stop counts to traffic link data}
\usage{
join_bus_to_traffic(df, bus_data)
}
\arguments{
\item{df}{A data frame containing traffic link data with columns:
\describe{
  \item{id}{Link identifier}
  \item{parentTrafficLinkId}{Parent link identifier}
  \item{aadt}{Annual Average Daily Traffic (may contain NAs)}
  \item{traffic_volume_source}{Source of traffic volume data}
  \item{traffic_volume_year}{Year of traffic volume measurement}
}}

\item{bus_data}{A data frame containing bus stop count data with columns:
\describe{
  \item{id}{Link identifier (matches df$id)}
  \item{bus_aadt}{Bus-derived AADT estimate}
  \item{bus_sd}{Standard deviation of bus AADT estimate}
  \item{stopPointRef}{Bus stop reference identifier}
  \item{stopCertainty}{Certainty/quality metric for bus estimate}
  \item{traffic_volume_source}{Source identifier for bus data}
  \item{traffic_volume_year}{Year of bus count data}
}}
}
\value{
A data frame with the same structure as df, with additional
  columns from bus_data (bus_sd, stopPointRef, stopCertainty). Missing AADT
  values are filled with bus_aadt where available, and metadata columns
  (traffic_volume_source, traffic_volume_year) are updated accordingly.
}
\description{
Supplements traffic link AADT values with bus stop counts where traffic data
is missing. Existing traffic link AADT values are never overwritten. Updates
traffic_volume_source and traffic_volume_year metadata only when bus data
fills a gap.
}
\details{
The function prioritizes existing traffic link AADT values over bus estimates.
Bus data is only used to fill gaps (NA values) in the traffic link data.
When bus data is used, the traffic_volume_source and traffic_volume_year are
updated to reflect the bus data source. Bus-specific columns (bus_sd,
stopPointRef, stopCertainty) are retained for all links where bus data exists,
regardless of whether the bus AADT was used.
}
\examples{
# Create example traffic data with some missing AADT values
df <- data.frame(
  id = c("L001", "L002", "L003", "L004"),
  parentTrafficLinkId = c("P001", "P001", "P002", "P002"),
  aadt = c(5000, NA, 3000, NA),
  heavyAadt = c(500, NA, NA, NA),
  traffic_volume_source = c("continuous", NA, "periodic", NA),
  traffic_volume_year = c(2024, NA, 2024, NA)
)

# Create example bus data
bus_data <- data.frame(
  id = c("L002", "L003", "L004"),
  parentTrafficLinkId = c("P001", "P002", "P002"),
  stopPointRef = c("NSR:12345", "NSR:67890", "NSR:11111"),
  bus_aadt = c(1200, 2500, 800),
  bus_sd = c(150, 200, 100),
  stopCertainty = c("high", "medium", "high"),
  traffic_volume_source = c("bus", "bus", "bus"),
  traffic_volume_year = c(2024, 2024, 2024)
)

# Join data - L002 and L004 will get bus AADT, L003 keeps original
result <- join_bus_to_traffic(df, bus_data)

# Check results
print(result)
# L001: aadt=5000 (original, no bus data available)
# L002: aadt=1200 (filled from bus), source="bus"
# L003: aadt=3000 (original kept, bus data ignored)
# L004: aadt=800 (filled from bus), source="bus"

}
