% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/validate_before_control.R
\name{calculate_preapproval_metrics}
\alias{calculate_preapproval_metrics}
\title{Calculate pre-approval metrics using previous year AADT}
\usage{
calculate_preapproval_metrics(
  model = NULL,
  pred = NULL,
  sd = NULL,
  data,
  previous_aadt_col = "lastYearAadt_aadt",
  model_name = "inla"
)
}
\arguments{
\item{model}{An INLA model object with summary.fitted.values. If NULL, must
provide pred and sd, or data must contain prediction columns.}

\item{pred}{Numeric vector of predictions. Used if model is NULL.}

\item{sd}{Numeric vector of standard deviations. Used if model is NULL.}

\item{data}{Data frame containing directed traffic link predictions with
columns parentTrafficLinkId, and optionally pred/sd or balanced_pred/balanced_sd.}

\item{previous_aadt_col}{Character. Name of column in data containing
previous year's AADT values. Default is "lastYearAadt_aadt".}

\item{model_name}{Character. Name to identify the model in output. Default
is "inla".}
}
\value{
List with three elements:
  \itemize{
    \item summary: Data frame with median_eale and other summary statistics
    \item directed_data: Original data with added predictions
    \item undirected_data: Aggregated undirected segments with eALE calculations
  }
}
\description{
Validates model predictions against previous year's AADT values before manual
control. This provides an early check that predictions are reasonable and helps
identify segments that may need closer review.
}
\details{
This function calculates exponential Absolute Log Error (eALE) between model
predictions and previous year's AADT. While predictions should ultimately match
the current year's true values, comparison with previous year provides a useful
sanity check since AADT typically doesn't change drastically year-over-year.

Large eALE values may indicate:
\itemize{
  \item Model predictions that need review
  \item Segments where traffic has genuinely changed significantly
  \item Data quality issues in either current predictions or previous AADT
}
}
\examples{
\dontrun{
pre_validation <- calculate_preapproval_metrics(
  model = inla_model,
  data = directed_predictions
)

# View median eALE
pre_validation$summary$median_eale

# Identify segments with large changes
large_changes <- pre_validation$undirected_data |>
  filter(eale > 0.5)
}

}
\seealso{
\code{\link{calculate_approval_metrics}} for validation against
  official (undirected) corrected values.
}
